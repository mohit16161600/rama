<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title><%= (title ? title + ' · ' : '') %><%= store.name %></title>
		<link rel="stylesheet" href="/css/styles.css" />
	</head>
	<body>
		<header class="header">
			<div class="container nav">
				<a href="/" class="brand"><%= store.name %></a>
				<a href="/categories">Categories</a>
				<span class="spacer"></span>
				<a href="/watchlist" class="pill">Watchlist (<%= (session.watchlist||[]).length %>)</a>
				<a href="/cart" class="pill">Cart (<%= (session.cart||[]).reduce((n,ci)=>n+ci.qty,0) %>)</a>
			</div>
		</header>
		<main class="container">
			<% /* Hero */ %>
<section class="hero">
	<div>
		<h1>Tailored Indian Dresses</h1>
		<p class="muted">Crafted to your measurements for comfort and confidence.</p>
		<p><a class="pill" href="/categories">Explore Categories</a></p>
	</div>
	<div>
		<img src="https://images.unsplash.com/photo-1583394838336-acd977736f90?q=80&w=1600&auto=format&fit=crop" alt="Tailored Dresses" />
	</div>
</section>

<% /* Categories grid */ %>
<h2>Shop by Category</h2>
<div class="grid">
	<% featuredCategories.forEach(c => { %>
		<a class="card" href="/category/<%= c.id %>">
			<img src="<%= c.heroImage %>" alt="<%= c.name %>" onerror="this.src='https://picsum.photos/seed/'+encodeURIComponent('<%= c.id %>')+'/600/400'"/>
			<div class="card-body">
				<h3><%= c.name %></h3>
				<p class="muted"><%= c.description %></p>
			</div>
		</a>
	<% }) %>
</div>

<% /* Featured products */ %>
<h2 style="margin-top:28px;">Featured</h2>
<div class="grid">
	<% featuredProducts.forEach(p => { %>
		<div class="card">
			<a href="/product/<%= p.id %>"><img src="<%= (p.images&&p.images[0]) || '' %>" alt="<%= p.name %>" onerror="this.src='https://picsum.photos/seed/'+encodeURIComponent('<%= p.id %>')+'/600/400'"/></a>
			<div class="card-body">
				<h3><a href="/product/<%= p.id %>"><%= p.name %></a></h3>
				<p class="price">₹ <%= p.price.toLocaleString('en-IN') %></p>
				<div style="display:flex; gap:8px;">
					<button class="pill" onclick="postJSON('/cart/add',{productId:'<%= p.id %>', qty:1}).then(()=>location.reload())">Add to cart</button>
					<button onclick="postJSON('/watchlist/toggle',{productId:'<%= p.id %>'}).then(()=>location.reload())">❤ Watch</button>
				</div>
			</div>
		</div>
	<% }) %>
</div>

		</main>
		<footer class="footer container">
			<div>&copy; <%= new Date().getFullYear() %> <%= store.name %> — <%= store.tagline %></div>
		</footer>
		<script>
		async function postJSON(url, data){
			const r = await fetch(url,{method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data)});
			return r.json();
		}
		</script>
	</body>
</html>
